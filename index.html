<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Lista de Empaque</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 32px;
        }

        .box-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
        }

        .input-group {
            margin: 20px 0;
            text-align: center;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #666;
            font-size: 16px;
        }

        input {
            padding: 15px;
            font-size: 18px;
            width: 300px;
            border: 2px solid #ddd;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #667eea;
        }

        button {
            padding: 15px 40px;
            font-size: 18px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .message {
            margin: 20px 0;
            font-size: 16px;
        }

        .error {
            color: #e74c3c;
            background: #fee;
            padding: 15px;
            border-radius: 10px;
        }

        .loading {
            color: #667eea;
            background: #eef;
            padding: 15px;
            border-radius: 10px;
        }

        .success {
            color: #27ae60;
            background: #efe;
            padding: 15px;
            border-radius: 10px;
        }

        .image-container {
            margin-top: 30px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            background: #f9f9f9;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            input {
                width: 100%;
                max-width: 300px;
            }

            .box-info {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ Sistema de Lista de Empaque</h1>

        <!-- InformaciÃ³n del nÃºmero de paquete (mostrada automÃ¡ticamente) -->
        <div class="box-info" id="boxInfo">
            Cargando informaciÃ³n del paquete...
        </div>

        <!-- Entrada de contraseÃ±a -->
        <div class="input-group">
            <label for="password">Ingrese la ContraseÃ±a de Acceso</label>
            <input
                type="password"
                id="password"
                placeholder="Ingrese contraseÃ±a"
                onkeypress="handleKeyPress(event)"
            >
        </div>

        <button onclick="verifyPassword()">Ver Lista de Empaque</button>

        <div id="message" class="message"></div>

        <!-- Ãrea de visualizaciÃ³n de imÃ¡genes -->
        <div id="imageContainer" class="image-container" style="display: none;"></div>
    </div>

    <script>
        // ============================================
        // ConfiguraciÃ³n - Modifique los datos aquÃ­
        // ============================================

        // ContraseÃ±a de acceso (modifique aquÃ­ para cambiar la contraseÃ±a)
        const ACCESS_PASSWORD = "123456";

        // ConfiguraciÃ³n de GitHub (solo modifique el nombre de usuario, todos los enlaces se generarÃ¡n automÃ¡ticamente)
        const GITHUB_USERNAME = "huamaohuanyu";  // âš ï¸ Cambie a su nombre de usuario de GitHub
        const GITHUB_REPO = "packinglist-system";    // Nombre del repositorio (generalmente no es necesario cambiar)
        const GITHUB_BRANCH = "main";              // Nombre de la rama (main o master, generalmente no es necesario cambiar)
        const GITHUB_BASE_URL = `https://github.com/${GITHUB_USERNAME}/${GITHUB_REPO}/raw/${GITHUB_BRANCH}/images/`;

        // ConfiguraciÃ³n de Datos de Lista de Empaque
        // Soporta mÃºltiples formatos de imagen: jpg, jpeg, png, webp
        // Ignora mayÃºsculas y minÃºsculas en el nÃºmero de paquete
        // Soporta mÃºltiples cajas con la misma imagen usando imageMapping

        // Lista de nÃºmeros de paquete
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// äº§å“è´§å·æ˜ å°„é…ç½®
// ç”Ÿæˆæ—¶é—´: 2026/1/20 01:50:10
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ============================================
// âš ï¸ é‡è¦æç¤ºï¼šè¯·å®Œæ•´å¤åˆ¶ä»¥ä¸‹å…¨éƒ¨ä»£ç ï¼ˆ3éƒ¨åˆ†ï¼‰
// ============================================
// ç¬¬1éƒ¨åˆ†: packingLists (ç®±å­åˆ—è¡¨)
// ç¬¬2éƒ¨åˆ†: productMapping (äº§å“è´§å·æ˜ å°„)
// ç¬¬3éƒ¨åˆ†: imageMapping = {} (æ¸…ç©ºå›¾ç‰‡æ˜ å°„ï¼Œå¿…é¡»åŒ…å«ï¼)
// ============================================

// Lista de nÃºmeros de paquete
const packingLists = [
    "CMEX-001",
    "CMEX-002",
    "CMEX-003",
    "CMEX-004",
    "CMEX-005",
    "CMEX-006",
    "CMEX-007",
    "CMEX-008",
    "CMEX-009",
    "CMEX-010"
];

// Mapeo de producto (Caja -> CÃ³digo de Producto)
// ä¼˜å…ˆçº§: productMapping > imageMapping > ç®±å­å·
// 10 cajas, 2 productos Ãºnicos
const productMapping = {
    "CMEX-001": "1169",  // Producto: 1169
    "CMEX-002": "1169",  // Producto: 1169
    "CMEX-003": "1169",  // Producto: 1169
    "CMEX-004": "1169",  // Producto: 1169
    "CMEX-005": "1169",  // Producto: 1169
    "CMEX-006": "9902",  // Producto: 9902
    "CMEX-007": "9902",  // Producto: 9902
    "CMEX-008": "9902",  // Producto: 9902
    "CMEX-009": "9902",  // Producto: 9902
    "CMEX-010": "9902"  // Producto: 9902
};

// âš ï¸âš ï¸âš ï¸ é‡è¦ï¼šè¿™ä¸€è¡Œå¿…é¡»å¤åˆ¶ï¼æ¸…ç©º imageMapping é¿å…å†²çª
const imageMapping = {};

// ============================================
// æ­¥éª¤2: å‡†å¤‡äº§å“å›¾ç‰‡
// ============================================
// åªéœ€è¦å‡†å¤‡ä»¥ä¸‹ 2 å¼ äº§å“å›¾ç‰‡ï¼š
// - 1169.jpg  (Cajas: CMEX-001 ~ CMEX-005)
// - 9902.jpg  (Cajas: CMEX-006 ~ CMEX-010)

// ============================================
// æ­¥éª¤3: ä¸Šä¼ å›¾ç‰‡åˆ° GitHub
// ============================================
// 1. è®¿é—®: https://github.com/huamaohuanyu/packinglist-system/tree/main/images
// 2. ä¸Šä¼ ä¸Šè¿° 2 å¼ å›¾ç‰‡åˆ° images æ–‡ä»¶å¤¹
// 3. ç¡®ä¿å›¾ç‰‡æ–‡ä»¶åä¸ productMapping ä¸­çš„è´§å·å®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

// ============================================
// è°ƒè¯•ä¿¡æ¯
// ============================================
// å›¾ç‰‡URLæ ¼å¼: https://github.com/huamaohuanyu/packinglist-system/raw/main/images/[äº§å“è´§å·].jpg
// ä¾‹å¦‚: https://github.com/huamaohuanyu/packinglist-system/raw/main/images/1169.jpg


        // ============================================
        // åˆå§‹åŒ–æ£€æŸ¥
        // ============================================

        // æ£€æŸ¥æ˜ å°„é…ç½®çš„ä¼˜å…ˆçº§
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('ğŸ“¦ æ˜ å°„é…ç½®æ£€æŸ¥');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

        const hasProductMapping = productMapping && Object.keys(productMapping).length > 0;
        const hasImageMapping = imageMapping && Object.keys(imageMapping).length > 0;

        console.log('productMapping:', hasProductMapping ? `âœ… å­˜åœ¨ (${Object.keys(productMapping).length} ä¸ªæ˜ å°„)` : 'âŒ ç©ºæˆ–æœªå®šä¹‰');
        console.log('imageMapping:', hasImageMapping ? `âš ï¸ å­˜åœ¨ (${Object.keys(imageMapping).length} ä¸ªæ˜ å°„)` : 'âœ… ç©ºæˆ–æœªå®šä¹‰');

        if (hasProductMapping && hasImageMapping) {
            console.warn('âš ï¸ è­¦å‘Š: productMapping å’Œ imageMapping åŒæ—¶å­˜åœ¨ï¼');
            console.warn('âš ï¸ ç³»ç»Ÿå°†ä¼˜å…ˆä½¿ç”¨ productMappingï¼ˆäº§å“è´§å·æ˜ å°„ï¼‰');
            console.warn('âš ï¸ å¦‚éœ€ä½¿ç”¨ imageMappingï¼Œè¯·å°† productMapping è®¾ä¸ºç©ºå¯¹è±¡: const productMapping = {};');
            console.warn('âš ï¸ å»ºè®®æ£€æŸ¥æ˜¯å¦ä»é…ç½®ç”Ÿæˆå™¨å¤åˆ¶äº†å®Œæ•´ä»£ç ï¼ˆéœ€è¦åŒæ—¶å¤åˆ¶ imageMapping = {}ï¼‰');
        }

        if (hasProductMapping) {
            console.log('âœ… å½“å‰æ¨¡å¼: äº§å“è´§å·æ˜ å°„æ¨¡å¼');
            console.log('âœ… ç¤ºä¾‹: CMEX-001 -> 1169 (å°†æ˜¾ç¤º 1169.jpg)');
        } else if (hasImageMapping) {
            console.log('âœ… å½“å‰æ¨¡å¼: å›¾ç‰‡æ˜ å°„æ¨¡å¼');
            console.log('âœ… ç¤ºä¾‹: CMEX-001 -> CMEX-001 (å°†æ˜¾ç¤º CMEX-001.jpg)');
        } else {
            console.log('âœ… å½“å‰æ¨¡å¼: é»˜è®¤æ¨¡å¼ï¼ˆç®±å­å·ï¼‰');
            console.log('âœ… ç¤ºä¾‹: CMEX-001 -> CMEX-001 (å°†æ˜¾ç¤º CMEX-001.jpg)');
        }

        // é¢å¤–æ£€æŸ¥ï¼šå¦‚æœä¸¤ä¸ªæ˜ å°„éƒ½ä¸ºç©ºï¼Œæç¤ºç”¨æˆ·ä½¿ç”¨é…ç½®ç”Ÿæˆå™¨
        if (!hasProductMapping && !hasImageMapping) {
            console.warn('ğŸ’¡ æç¤º: å½“å‰æ²¡æœ‰é…ç½®ä»»ä½•æ˜ å°„');
            console.warn('ğŸ’¡ å»ºè®®: ä½¿ç”¨ç®€åŒ–æ‰¹é‡é…ç½®ç”Ÿæˆå™¨ç”Ÿæˆé…ç½®ä»£ç ');
            console.warn('ğŸ’¡ è®¿é—®: ç®€åŒ–æ‰¹é‡é…ç½®ç”Ÿæˆå™¨.html');
        }

        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

        // ============================================
        // è¯Šæ–­å·¥å…·ï¼ˆä»…åœ¨è°ƒè¯•æ—¶ä½¿ç”¨ï¼‰
        // ============================================

        // åœ¨æ§åˆ¶å°æ˜¾ç¤ºç³»ç»Ÿé…ç½®ä¿¡æ¯
        function showSystemDiagnostic() {
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ“¦ ç³»ç»Ÿè¯Šæ–­ä¿¡æ¯');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('å½“å‰ç®±å·:', currentBox);
            console.log('å¯†ç é…ç½®:', ACCESS_PASSWORD);
            console.log('GitHubé…ç½®:', {
                ç”¨æˆ·å: GITHUB_USERNAME,
                ä»“åº“: GITHUB_REPO,
                åˆ†æ”¯: GITHUB_BRANCH,
                åŸºç¡€URL: GITHUB_BASE_URL
            });
            console.log('ç®±å­åˆ—è¡¨:', packingLists);
            console.log('äº§å“æ˜ å°„:', productMapping);
            console.log('å›¾ç‰‡æ˜ å°„:', imageMapping);
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        }

        // ============================================
        // CÃ³digo del Programa (No es necesario modificar)
        // ============================================

        // Datos del paquete actual
        let currentBox = null;

        // é…ç½®éªŒè¯å‡½æ•°
        function validateConfiguration() {
            const errors = [];

            // éªŒè¯ packingLists
            if (!Array.isArray(packingLists) || packingLists.length === 0) {
                errors.push('packingLists ä¸èƒ½ä¸ºç©º');
            }

            // éªŒè¯ productMapping
            if (productMapping && typeof productMapping !== 'object') {
                errors.push('productMapping å¿…é¡»æ˜¯å¯¹è±¡');
            }

            // éªŒè¯ imageMapping
            if (imageMapping && typeof imageMapping !== 'object') {
                errors.push('imageMapping å¿…é¡»æ˜¯å¯¹è±¡');
            }

            // éªŒè¯æ‰€æœ‰æ˜ å°„çš„ç®±å­å·æ˜¯å¦åœ¨ packingLists ä¸­
            if (productMapping) {
                Object.keys(productMapping).forEach(boxNumber => {
                    if (!packingLists.includes(boxNumber)) {
                        errors.push(`productMapping ä¸­çš„ç®±å­å· ${boxNumber} ä¸åœ¨ packingLists ä¸­`);
                    }
                });
            }

            if (imageMapping) {
                Object.keys(imageMapping).forEach(boxNumber => {
                    if (!packingLists.includes(boxNumber)) {
                        errors.push(`imageMapping ä¸­çš„ç®±å­å· ${boxNumber} ä¸åœ¨ packingLists ä¸­`);
                    }
                });
            }

            // å¦‚æœæœ‰é”™è¯¯ï¼Œæ˜¾ç¤ºè­¦å‘Š
            if (errors.length > 0) {
                console.warn('é…ç½®éªŒè¯è­¦å‘Šï¼š', errors);
            }

            return errors.length === 0;
        }

        // Ejecutar cuando la pÃ¡gina carga
        window.onload = function() {
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            console.log('ğŸ“¦ é¡µé¢åŠ è½½åˆå§‹åŒ–');
            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

            // éªŒè¯é…ç½®
            validateConfiguration();

            // Obtener nÃºmero de paquete de la URL
            const urlParams = new URLSearchParams(window.location.search);
            let boxNumber = urlParams.get('box');

            // Convertir a mayÃºsculas para ignorar mayÃºsculas/minÃºsculas
            if (boxNumber) {
                boxNumber = boxNumber.toUpperCase();
            }

            // DepuraciÃ³n: Mostrar el nÃºmero de paquete recibido
            console.log('ğŸ” URLå‚æ•° box:', urlParams.get('box'));
            console.log('ğŸ” è½¬æ¢åç®±å·:', boxNumber);
            console.log('ğŸ” packingLists æ•°é‡:', packingLists.length);
            console.log('ğŸ” packingLists å†…å®¹:', packingLists);
            console.log('ğŸ” å½“å‰URL:', window.location.href);

            if (boxNumber) {
                // Buscar datos del paquete correspondiente (ignorando mayÃºsculas/minÃºsculas)
                currentBox = packingLists.find(box => box.toUpperCase() === boxNumber);

                if (currentBox) {
                    // Mostrar informaciÃ³n del paquete
                    document.getElementById('boxInfo').textContent = `ğŸ“¦ ${currentBox}`;
                    document.getElementById('boxInfo').style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                    console.log('âœ… Paquete encontrado:', currentBox);
                } else {
                    // NÃºmero de paquete no encontrado
                    document.getElementById('boxInfo').textContent = `âŒ Paquete No Encontrado: ${boxNumber}`;
                    document.getElementById('boxInfo').style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                    document.getElementById('message').innerHTML = `<p class="error">NÃºmero de paquete invÃ¡lido: ${boxNumber}<br>Por favor contacte al remitente.</p>`;
                    console.error('âŒ Paquete no encontrado en laåˆ—è¡¨');
                    console.error('âŒ å¯ç”¨çš„ç®±å·:', packingLists);
                }
            } else {
                // No se proporcionÃ³ nÃºmero de paquete
                document.getElementById('boxInfo').textContent = 'âŒ Sin NÃºmero de Paquete';
                document.getElementById('boxInfo').style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                document.getElementById('message').innerHTML = '<p class="error">Por favor escanee el cÃ³digo QR correcto.</p>';
                console.warn('âš ï¸ No se proporcionÃ³ nÃºmero de paquete en la URL');
                console.warn('âš ï¸ æ­£ç¡®çš„URLæ ¼å¼: index.html?box=CMEX-001');
            }

            console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        };

        // Manejar tecla Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                verifyPassword();
            }
        }

        // Verificar contraseÃ±a
        function verifyPassword() {
            const passwordInput = document.getElementById('password');
            const password = passwordInput.value.trim();
            const messageDiv = document.getElementById('message');
            const imageContainer = document.getElementById('imageContainer');

            // Limpiar contenido anterior
            messageDiv.innerHTML = '';
            imageContainer.style.display = 'none';
            imageContainer.innerHTML = '';

            // Verificar si se encontrÃ³ el paquete
            if (!currentBox) {
                messageDiv.innerHTML = '<p class="error">NÃºmero de paquete invÃ¡lido. Por favor contacte al remitente.</p>';
                return;
            }

            // Generar URL de imagen (prioridad: productMapping > imageMapping > nÃºmero de caja)
            const imageFormats = ['jpg', 'jpeg', 'png', 'webp'];
            let imageFile;

            console.log('ğŸ” å¼€å§‹ç”Ÿæˆå›¾ç‰‡URL...');
            console.log('å½“å‰ç®±å­:', currentBox);
            console.log('productMapping:', productMapping);
            console.log('imageMapping:', imageMapping);

            // 1. Primero verificar productMapping (Caja -> CÃ³digo de Producto)
            if (productMapping && Object.keys(productMapping).length > 0 && productMapping[currentBox]) {
                imageFile = productMapping[currentBox];
                console.log('âœ… ä½¿ç”¨ productMapping:', currentBox, '->', imageFile);
            }
            // 2. Si no existe productMapping, verificar imageMapping (Caja -> Archivo de imagen)
            else if (imageMapping && Object.keys(imageMapping).length > 0 && imageMapping[currentBox]) {
                imageFile = imageMapping[currentBox];
                console.log('âœ… ä½¿ç”¨ imageMapping:', currentBox, '->', imageFile);
            }
            // 3. Si no existe ninguno, usar el nÃºmero de caja
            else {
                imageFile = currentBox;
                console.log('âš ï¸ ä½¿ç”¨ç®±å­å·ä½œä¸ºå›¾ç‰‡æ–‡ä»¶å:', currentBox);
            }

            // ä¼˜å…ˆä½¿ç”¨ jpg æ ¼å¼ï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨å°è¯•å…¶ä»–æ ¼å¼ï¼‰
            let imageUrl = GITHUB_BASE_URL + imageFile + '.jpg';

            console.log('ğŸ“¤ æœ€ç»ˆå›¾ç‰‡URL:', imageUrl);

            // Verificar contraseÃ±a
            if (password === '') {
                messageDiv.innerHTML = '<p class="error">Por favor ingrese una contraseÃ±a.</p>';
                return;
            }

            // ComparaciÃ³n de contraseÃ±as (agregar informaciÃ³n de depuraciÃ³n)
            console.log('ContraseÃ±a ingresada:', password);
            console.log('ContraseÃ±a correcta:', ACCESS_PASSWORD);
            console.log('Longitud de contraseÃ±a - Ingresada:', password.length, 'Correcta:', ACCESS_PASSWORD.length);

            if (password !== ACCESS_PASSWORD) {
                messageDiv.innerHTML = '<p class="error">ContraseÃ±a incorrecta. Por favor intÃ©ntelo de nuevo.</p>';
                console.log('VerificaciÃ³n de contraseÃ±a fallida');
                console.log('CÃ³digos de caracteres de la contraseÃ±a ingresada:', password.split('').map(c => c.charCodeAt(0)).join(', '));
                console.log('CÃ³digos de caracteres de la contraseÃ±a correcta:', ACCESS_PASSWORD.split('').map(c => c.charCodeAt(0)).join(', '));
                passwordInput.value = ''; // Limpiar entrada de contraseÃ±a
                passwordInput.focus(); // Enfocar en entrada de contraseÃ±a
                return;
            }

            // ContraseÃ±a correcta, mostrar lista de empaque
            messageDiv.innerHTML = '<p class="success">âœ… ContraseÃ±a correcta. Cargando lista de empaque...</p>';

            // é¢„åŠ è½½å›¾ç‰‡
            const img = new Image();

            // âš ï¸ æ³¨æ„: GitHub Raw ä¸æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼Œç§»é™¤ crossOrigin å±æ€§
            // å¦‚æœéœ€è¦è·¨åŸŸåŠ è½½å›¾ç‰‡ï¼Œè¯·ä½¿ç”¨ GitHub Pages æˆ–å…¶ä»–æ”¯æŒ CORS çš„æœåŠ¡
            // img.crossOrigin = 'anonymous';  // å·²æ³¨é‡Šï¼Œé¿å… CORS é”™è¯¯

            img.onload = function() {
                // å›¾ç‰‡åŠ è½½æˆåŠŸ
                messageDiv.innerHTML = '';
                imageContainer.style.display = 'block';
                imageContainer.innerHTML = `
                    <img
                        src="${imageUrl}"
                        alt="${currentBox}"
                        style="max-width: 100%; height: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);"
                    />
                `;
                console.log('âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ:', imageUrl);
            };

            img.onerror = function() {
                // å›¾ç‰‡åŠ è½½å¤±è´¥ - æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                const errorDetails = `
                    <div style="text-align: left; padding: 10px;">
                        <p class="error">âŒ å›¾ç‰‡åŠ è½½å¤±è´¥</p>
                        <p style="margin-top: 10px; font-size: 14px;">
                            <strong>è¯¦ç»†ä¿¡æ¯ï¼š</strong><br>
                            â€¢ ç®±å·ï¼š${currentBox}<br>
                            â€¢ å›¾ç‰‡æ–‡ä»¶ï¼š${imageFile}.jpg<br>
                            â€¢ å®Œæ•´URLï¼š<a href="${imageUrl}" target="_blank" style="color: #667eea;">${imageUrl}</a>
                        </p>
                        <p style="margin-top: 10px; font-size: 14px; color: #e74c3c;">
                            <strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>
                            1. å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨äº GitHub ä»“åº“<br>
                            2. GitHub ç”¨æˆ·åé…ç½®é”™è¯¯<br>
                            3. æ–‡ä»¶å‘½åä¸åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰<br>
                            4. ä»“åº“æœªå…¬å¼€æˆ– GitHub Raw è®¿é—®å—é™<br>
                            5. ç½‘ç»œè¿æ¥é—®é¢˜
                        </p>
                        <p style="margin-top: 10px; font-size: 12px; color: #666;">
                            ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¸Šæ–¹é“¾æ¥æµ‹è¯•å›¾ç‰‡æ˜¯å¦å¯è®¿é—®<br>
                            ğŸ’¡ å¦‚æœé“¾æ¥å¯ä»¥æ‰“å¼€ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•
                        </p>
                    </div>
                `;
                messageDiv.innerHTML = errorDetails;
                imageContainer.style.display = 'block';
                imageContainer.innerHTML = `
                    <img
                        src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjE2IiBmaWxsPSIjOTk5Ij7ogY7liLDmlrDliIblj7fwn548L3RleHQ+PC9zdmc+"
                        alt="Error al cargar imagen"
                        style="border-radius: 10px;"
                    />
                `;
                console.error('âŒ å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl);
                console.error('è¯·æ£€æŸ¥ï¼š', {
                    'å½“å‰ç®±å·': currentBox,
                    'å›¾ç‰‡æ–‡ä»¶': imageFile + '.jpg',
                    'å®Œæ•´URL': imageUrl,
                    'GitHubç”¨æˆ·å': GITHUB_USERNAME,
                    'ä»“åº“å': GITHUB_REPO,
                    'åˆ†æ”¯': GITHUB_BRANCH
                });

                // æä¾›é‡è¯•æŒ‰é’®
                setTimeout(() => {
                    if (messageDiv.innerHTML.includes('å›¾ç‰‡åŠ è½½å¤±è´¥')) {
                        const retryBtn = document.createElement('button');
                        retryBtn.innerHTML = 'ğŸ”„ é‡æ–°åŠ è½½å›¾ç‰‡';
                        retryBtn.style.cssText = 'margin-top: 10px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;';
                        retryBtn.onclick = function() {
                            verifyPassword();
                        };
                        messageDiv.appendChild(retryBtn);
                    }
                }, 100);
            };

            img.src = imageUrl;
        }
    </script>
</body>
</html>
